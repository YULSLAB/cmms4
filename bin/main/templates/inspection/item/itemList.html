<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/defaultLayout}">
<head>
    <title th:text="'Items for Schedule: ' + (${schedule} ? ${schedule.scheduleId} : '') + (${schedule?.inspection} ? ' of Inspection: ' + (${schedule.inspection.inspectionName} ?: ${schedule.inspection.inspectionId}) : '')">Inspection Items</title>
</head>
<body>

<div layout:fragment="content">
    <div class="container mt-4">
        <!-- User info (from session) - Handled by layout/defaultLayout.html -->

        <div th:if="${schedule}">
             <h1 th:text="'Items for Schedule: ' + ${schedule.scheduleId}">Items</h1>
             <div th:if="${schedule.inspection}" class="mb-2 alert alert-secondary">
                 <h5>Parent Details</h5>
                 <p><strong>Inspection:</strong> <span th:text="${schedule.inspection.inspectionName ?: schedule.inspection.inspectionId}"></span> (ID: <span th:text="${schedule.inspectionId}"></span>)</p>
                 <p><strong>Schedule ID:</strong> <span th:text="${schedule.scheduleId}"></span></p>
                 <p><strong>Company ID:</strong> <span th:text="${schedule.companyId}"></span></p>
             </div>
        </div>
         <div th:unless="${schedule}">
            <h1>Inspection Items</h1>
            <p class="alert alert-warning">Parent schedule details not available.</p>
        </div>
        
        <div th:if="${successMessage}" class="alert alert-success alert-dismissible fade show" role="alert">
            <span th:text="${successMessage}"></span>
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
        <div th:if="${errorMessage}" class="alert alert-danger alert-dismissible fade show" role="alert">
            <span th:text="${errorMessage}"></span>
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>

        <div class="mb-3">
            <a th:if="${schedule}" th:href="@{/inspections/{inspectionId}/schedules/{scheduleId}/items/new(inspectionId=${schedule.inspectionId}, scheduleId=${schedule.scheduleId}, companyId=${schedule.companyId})}" class="btn btn-primary">Add New Item</a>
            <a th:if="${schedule}" th:href="@{/inspections/{inspectionId}/schedules(inspectionId=${schedule.inspectionId}, companyId=${schedule.companyId})}" class="btn btn-secondary">Back to Schedules</a>
            <a th:unless="${schedule}" th:href="@{/inspections/list(companyId=${companyId ?: ''}, siteId=${siteId ?: ''})}" class="btn btn-secondary">Back to Inspection List</a>
        </div>

        <div class="card">
            <div class="card-header">
                Item List
            </div>
            <div class="card-body">
                <table class="table table-striped table-hover">
                    <thead class="thead-light">
                        <tr>
                            <th>Item ID</th>
                            <th>Item Name</th>
                            <th>Method</th>
                            <th>Unit</th>
                            <th>Result</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr th:each="itm : ${items}">
                            <td th:text="${itm.itemId}"></td>
                            <td th:text="${itm.itemName}"></td>
                            <td th:text="${itm.itemMethod}"></td>
                            <td th:text="${itm.itemUnit}"></td>
                            <td th:text="${itm.itemResult}"></td>
                            <td>
                                <a th:href="@{/inspections/{inspId}/schedules/{schId}/items/{itmId}/edit(inspId=${itm.inspectionId}, schId=${itm.scheduleId}, itmId=${itm.itemId}, companyId=${itm.companyId})}" class="btn btn-sm btn-warning">Edit</a>
                                <form th:action="@{/inspections/{inspId}/schedules/{schId}/items/{itmId}/delete(inspId=${itm.inspectionId}, schId=${itm.scheduleId}, itmId=${itm.itemId}, companyId=${itm.companyId})}" method="post" style="display:inline;" onsubmit="return confirm('Are you sure you want to delete this item?');">
                                    <button type="submit" class="btn btn-sm btn-danger">Delete</button>
                                </form>
                            </td>
                        </tr>
                        <tr th:if="${#lists.isEmpty(items)}">
                            <td colspan="6" class="text-center">No items found for this schedule.</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

</body>
</html>
